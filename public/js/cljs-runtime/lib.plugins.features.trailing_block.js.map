{"version":3,"file":"lib.plugins.features.trailing_block.js","sources":["lib/plugins/features/trailing_block.cljs"],"mappings":";;;AAKA,0DAAA,1DAAKA;AAEL,0DAAA,1DAAMC;AAAN,AACE,OAASC,iDACA,qBAAA,2CAAA,6GAAA,wDAAA,rOAACC,qHAAeH,mMACE,AAASI;;AAEtC,8DAAA,9DAAMC,oIAAyBC;AAA/B,AACE,IAAMC,aAAW,AAAQC;IACnBC,QAAM,AAACR;AADb,AAEE;kBAAKS;AAAL,AACE,OAAkBA,uBAAOC,SAASJ,WAAWE;;;;AAEnD,sDAAA,tDAAMG,oHAAWN;AAAjB,AACE,gEAAA,zDAACO,6CAAEC;;AAEL,oEAAA,pEAAMC,gJAAyBT;AAA/B,AACE,IAAAU,WAAQR;IAARQ,eAAA,EAAA,CAAAA,YAAA,OAAA,KACQ,AAAAA;IADRA,eAAA,EAAA,CAAAA,gBAAA,OAAA,KAEQ,CAAAA,aAAA;AAFR,AAAA,GAAA,CAAAA,gBAAA;AAAA;;AAGQ,oDAAAA,7CAACH,0DAAEb;;;AAEb,iEAAA,jEAAMiB,0IAAsBX;AAA5B,AACE,IAAAY,WAAQV;IAARU,eAAA,EAAA,CAAAA,YAAA,OAAA,KACQ,AAAAA;AADR,AAAA,GAAA,CAAAA,gBAAA;AAAA;;AAEQ,QAAAA,aAAA;;;AAEV,oDAAA,pDAAMC,gHAAeb;AAArB,AACE,oBAAM,iBAAAc,oBACC,AAACR,oDAAUN;AADZ,AAAA,oBAAAc;AAEC,OAACC,cAAI,iBAAAD,wBACC,AAACL,kEAAwBT;AAD1B,AAAA,oBAAAc;AAEC,OAACH,+DAAqBX;;AAFvBc;;;;AAFNA;;;AAAN,AAKE,OAACf,4DAAwBC;;AAL3B;;;AAOF,AAAA;;;qDAAA,6DAAAgB,lHAAME;AAAN,AAAA,IAAAD,WAAA,AAAA;AAAA,AAAA,QAAAA;KAAA;AAAA,OAAAC,iFAAA,CAAA,UAAA;;;KAAA;AAAA,OAAAA;;;;AAAA,MAAA,KAAAC,MAAA,CAAA,8DAAA,AAAA;;;;;AAAA,AAAA,mFAAA,nFAAMD,8FAEFE;AAFJ,AAAA,kDAAA,sEAKkBP;;;AALlB,AAAA,mFAAA,nFAAMK;AAAN,AAOG,wFAAA,jFAACG;;;AAPJ,AAAA,6EAAA,7EAAMH;;AAAN","names":["lib.plugins.features.trailing-block/trailing-block-type","lib.plugins.features.trailing-block/make-trailing-block","js/module$node_modules$slate$lib$slate.Block","cljs.core/clj->js","js/module$node_modules$slate$lib$slate.Text","lib.plugins.features.trailing-block/trailing-block-inserter","node","last-index","node/nodes","block","change","node/key","lib.plugins.features.trailing-block/document?","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","node/object","lib.plugins.features.trailing-block/ends-in-trailing-block?","G__26215","lib.plugins.features.trailing-block/ends-in-empty-block?","G__26217","lib.plugins.features.trailing-block/validate-node","and__3938__auto__","cljs.core/not","var_args","G__26220","lib.plugins.features.trailing-block/trailing-block","js/Error","options","lib.plugins.features.trailing_block.trailing_block.cljs$core$IFn$_invoke$arity$1"],"sourcesContent":["(ns lib.plugins.features.trailing-block\n  (:require [\"slate\" :as slate]))\n\n; taken from https://github.com/GitbookIO/slate-trailing-block/blob/master/lib/index.js\n\n(def trailing-block-type \"paragraph\")\n\n(defn make-trailing-block []\n  (.create slate/Block\n           (clj->js {:type trailing-block-type\n                     :nodes [(.create slate/Text)]})))\n\n(defn trailing-block-inserter [node]\n  (let [last-index (.count node.nodes)\n        block (make-trailing-block)]\n    (fn [change]\n      (.insertNodeByKey change node.key last-index block))))\n\n(defn document? [node]\n  (= node.object \"document\"))\n\n(defn ends-in-trailing-block? [node]\n  (some-> node.nodes\n          (.last)\n          (aget \"type\")\n          (= trailing-block-type)))\n\n(defn ends-in-empty-block? [node]\n  (some-> node.nodes\n          (.last)\n          (aget \"isEmpty\")))\n\n(defn validate-node [node]\n  (when (and\n         (document? node)\n         (not (and\n               (ends-in-trailing-block? node)\n               (ends-in-empty-block? node))))\n    (trailing-block-inserter node)))\n\n(defn trailing-block\n  \"Ensures there is always an empty block at the end of a doc\"\n  ([options]\n   ; TODO: validateNode only seems to be invoked on enter,\n   ;  In order to always have a trailing empty block find a better time to invoke this\n   {:validateNode validate-node})\n  ([]\n   (trailing-block {})))\n"]}