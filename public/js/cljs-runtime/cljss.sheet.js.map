{"version":3,"file":"cljss.sheet.js","sources":["cljss/sheet.cljs"],"mappings":"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","names":["cljss.sheet/limit","cljss.sheet/make-style-tag","tag","goog.dom/createElement","head","goog.dom/getElementsByTagNameAndClass","goog.object/set","G__26079","G__26080","goog.dom/appendChild","goog.dom/createTextNode","x__4243__auto__","m__4244__auto__","cljss/sheet.insert!","goog/typeOf","cljs.core/missing-protocol","cljss/sheet.flush!","cljss/sheet.filled?","cljss.sheet/ISheet","cljss.sheet/insert!","this","css","cls-name","cljss.sheet/flush!","cljss.sheet/filled?","cljs.core/PROTOCOL_SENTINEL","this__4192__auto__","writer__4193__auto__","opt__4194__auto__","cljs.core/-write","cljss.sheet/Sheet","cljss.sheet/->Sheet","sheet","cache","rule","js/Error","fexpr__26086","cljs.core/deref","cljs.core.swap_BANG_.cljs$core$IFn$_invoke$arity$3","cljs.core/conj","cljs.core/ifn?","rules-count","G__26087","G__26088","goog.object/get","cljss.utils/dev?","G__26089","G__26090","e26091","e","js/console.warn","cljs.core._EQ_.cljs$core$IFn$_invoke$arity$2","cljs.core/count","cljss.sheet/create-sheet","cljs.core.atom.cljs$core$IFn$_invoke$arity$1"],"sourcesContent":["(ns cljss.sheet\n  (:require [goog.object :as gobj]\n            [goog.dom :as dom]\n            [cljss.utils :refer [dev?]]))\n\n(def ^:private limit 65534)\n\n(defn- make-style-tag []\n  (let [tag (dom/createElement \"style\")\n        head (aget (dom/getElementsByTagNameAndClass \"head\") 0)]\n    (gobj/set tag \"type\" \"text/css\")\n    (dom/appendChild tag (dom/createTextNode \"\"))\n    (dom/appendChild head tag)\n    tag))\n\n\n(defprotocol ISheet\n  (insert! [this css cls-name])\n  (flush! [this])\n  (filled? [this]))\n\n(deftype Sheet [tag sheet cache]\n  ISheet\n  (insert! [this rule cls-name]\n    (when (filled? this)\n      (throw (js/Error. (str \"A stylesheet can only have \" limit \" rules\"))))\n    (when-not (@cache cls-name)\n      (swap! cache conj cls-name)\n      (let [rule (if (ifn? rule) (rule) rule)\n            rules-count (gobj/get (gobj/get sheet \"cssRules\") \"length\")]\n        (if dev?\n          (dom/appendChild tag (dom/createTextNode rule))\n          (try\n            (.insertRule sheet rule rules-count)\n            (catch :default e\n              (when dev?\n                (js/console.warn \"Illegal CSS rule\" rule))))))))\n  (flush! [this]\n    (-> tag\n        .-parentNode\n        (.removeChild tag)))\n  (filled? [this]\n    (= (count @cache) limit)))\n\n(defn create-sheet []\n  (let [tag (make-style-tag)\n        sheet (gobj/get tag \"sheet\")]\n    (Sheet. tag sheet (atom #{}))))\n"]}